# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Common Development Commands

### Building and Rebuilding
- `zcli rebuild` - Rebuild the NixOS system configuration with safety checks
- `zcli update` - Update flake inputs and rebuild the system
- `fr` - Flake rebuild alias (available after first install)
- `sudo nixos-rebuild switch --flake .#<profile>` - Manual rebuild for specific profile
- `nix flake check` - Check flake for errors and validate configuration

### Available Profiles
The flake defines several hardware profiles in `flake.nix`:
- `amd` - AMD GPU systems
- `nvidia` - NVIDIA GPU systems  
- `nvidia-laptop` - NVIDIA laptop with Prime support
- `intel` - Intel integrated graphics
- `vm` - Virtual machine configurations

### Maintenance Commands
- `zcli cleanup` - Remove old system generations to free space
- `zcli trim` - Optimize filesystems (especially for SSDs)
- `zcli diag` - Generate system diagnostic report to `~/diag.txt`
- `zcli list-gens` - List user and system generations
- `zcli update-host [hostname] [profile]` - Auto-detect and set host/profile in flake.nix

### Flake Management
- `nix flake update` - Update all flake inputs
- `nix flake show` - Show available configurations and packages

## Architecture Overview

### Directory Structure
- `flake.nix` - Main flake configuration defining system profiles
- `hosts/` - Host-specific configurations (hardware.nix, variables.nix, host-packages.nix)
- `modules/core/` - Core system modules (boot, networking, security, packages, etc.)
- `modules/home/` - Home Manager configurations (user applications and dotfiles)
- `modules/drivers/` - Hardware-specific driver configurations
- `profiles/` - Pre-configured hardware profiles that import appropriate modules
- `wallpapers/` - System wallpaper collection

### Key Configuration Files
- `hosts/<hostname>/variables.nix` - Host-specific variables (monitors, browser, terminal, etc.)
- `hosts/<hostname>/hardware.nix` - Hardware-specific configuration (generated by nixos-generate-config)
- `hosts/<hostname>/host-packages.nix` - Host-specific package installations
- `modules/core/packages.nix` - System-wide packages
- `modules/core/user.nix` - User account configuration and user-specific packages

### Module System
The configuration uses a modular approach where:
- Core modules handle system-level configuration
- Home modules manage user applications via Home Manager
- Driver modules provide hardware-specific settings
- Profiles combine modules for different hardware configurations

### Theming and Customization
- Uses Stylix for system-wide theming based on wallpaper colors
- Hyprland window manager with multiple animation style options
- Multiple Waybar configurations available
- Wallpaper selection in `hosts/<hostname>/variables.nix`

### Key Variables to Modify
When setting up a new host, edit `hosts/<hostname>/variables.nix`:
- Monitor configuration (`extraMonitorSettings`)
- Default applications (`browser`, `terminal`) 
- Keyboard layout (`keyboardLayout`)
- Theme settings (`stylixImage`, `waybarChoice`, `animChoice`)
- Hardware-specific settings (Nvidia Prime IDs if applicable)

### Home Manager Integration
User configurations are managed through Home Manager modules in `modules/home/`, including:
- Shell configurations (bash, zsh with oh-my-zsh)
- Development tools (git, neovim via nvf, tmux)
- GUI applications (browsers, terminals, media tools)
- Desktop environment (Hyprland, rofi, waybar, notification center)

The system integrates NixOS system configuration with Home Manager for a complete declarative setup.